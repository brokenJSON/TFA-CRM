<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TFA CRM – Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>

    /* reset so padding/borders behave */
    * { box-sizing: border-box; }

    /* page basics */
    body {
      margin: 0;
      background: #f5f5f5;   /* light gray page background */
      color: #222;           /* dark text */
      font: 16px/1.4 Arial, Helvetica, sans-serif;
    }

    /* links */
    a {
      color: #063F1E;        /* deep green (TFA COLOR CODE) */
      text-decoration: none;
    }
    a:hover { text-decoration: underline; }

    /* header / branding */
    .brand-bar {
      background: #063F1E;   /* deep green bar (TFA COLOR CODE) */
      color: #ffffff;
      border-bottom: 4px solid #D89F01; /* gold accent (TFA COLOR CODE) */
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* build out logos */
    .logo {
      width: 46px;
      height: 46px;
      border-radius: 10px;
      background: #D89F01;   /* gold fill behind transparent PNGs looks fine */
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #063F1E;        /* green text if you ever show letters */
      font-weight: bold;
    }

    /* page shell */
    .shell {
      max-width: 1100px;
      margin: 16px auto 32px;
      padding: 0 16px;
    }

    /* top nav */
    .nav {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
    }
    .nav a,
    .nav button {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #063F1E;
      background: #ffffff;
      color: #063F1E;
      cursor: pointer;
    }
    .nav .logout {
      border-color: #8b1a1a;
      color: #8b1a1a;
    }

    /* Two-column area (left content + right tasks) */
    .grid {
      display: flex;
      gap: 16px;
    }
    .grid > * {
      flex: 1;               /* both columns take space */
    }
    .grid > :first-child {
      flex: 2;               /* left side bigger */
    }

    /* Stack columns on small screens */
    @media (max-width: 900px) {
      .grid { flex-direction: column; }
    }

    /* Card */
    .card {
      background: #ffffff;
      border: 1px solid #e3e3e3;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    h2 {
      margin: 0 0 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid #eaeaea;
    }

    /* Quick actions list */
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .action {
      flex: 1 1 180px;       /* grow/shrink, min width */
      border: 1px dashed #dcdcdc;
      border-radius: 10px;
      background: #fff;
      padding: 12px;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      margin-top: 6px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      background: #063F1E;   /* primary green */
      color: #fff;
      cursor: pointer;
    }
    .btn:hover { background: #0a4e28; }   /* a bit darker */
    .btn.secondary {
      background: #D89F01;   /* gold */
      color: #3f2f00;
    }
    .btn.danger {
      background: #8b1a1a;   /* red-ish */
      color: #fff;
    }

    /* form basics */
    label {
      display: block;
      font-weight: bold;
      margin: .6rem 0 .25rem;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cccccc;
      border-radius: 8px;
      background: #fff;
      outline: none;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #D89F01;  /* gold focus */
      box-shadow: 0 0 0 3px rgba(216,159,1,0.25);
    }

    /* row layout */
    .row {
      display: flex;
      gap: 10px;
    }
    .row > * { flex: 1; }

    /* table for contacts */
    table {
      width: 100%;
      border-collapse: collapse;   /* simple table lines */
      background: #fff;
    }
    th, td {
      padding: 10px 12px;
      border: 1px solid #eee;
      text-align: left;
    }
    th { background: #fafafa; }

    /* Small pill/tag */
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #fff6da;          /* pale gold */
      border: 1px solid #D89F01;
      color: #5b4500;
    }

    /* Empty state + muted text */
    .empty {
      padding: 16px;
      border: 1px dashed #cccccc;
      border-radius: 10px;
      text-align: center;
      background: #fff;
      color: #777;
    }
    .muted { color: #777; }

    /* ============ Email Flow (proposal-only sponosor feedback needed) ============ */
    .flow-card .meta { display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 14px }
    .badge {
      display:inline-block; font-weight:700; font-size:12px;
      padding:4px 8px; border-radius:999px; border:1px solid #D89F01;
      background:#fff6da; color:#5b4500;
    }
    .flow { display:flex; flex-direction:column; gap:16px }
    .flow-row { display:flex; flex-wrap:wrap; gap:12px }
    .node {
      background:#fff; border:1px solid #e3e3e3; border-radius:12px;
      padding:12px; box-shadow:0 6px 14px rgba(0,0,0,0.08);
      min-width: 220px; flex: 1;
    }
    .node h4 { margin:0 0 6px; color:#063F1E }
    .kv { margin:4px 0; font-size:14px }
    .kv b { color:#444 }
    .btn-ghost-sm {
      border:1px solid #063F1E; background:#fff; color:#063F1E;
      padding:6px 10px; border-radius:10px; font-weight:600; cursor:default;
    }
    .flow-arrows { display:flex; justify-content:center; align-items:center }
    .flow-arrows svg { width:56px; height:30px }
    .note { color:#777; font-size:13px }
  </style>
</head>
<body>
  <header class="brand-bar">
    <div class="container">
      <div class="brand">
        <img src="\images\TFA_Logo_Asset 14.png" class="logo" alt="The Family Advocates logo">
        <!-- <div class="logo">TFA</div> -->
        <div>
          <div style="font-weight:800">The Family Advocates</div>
          <small>CRM Dashboard</small>
        </div>
      </div>
      <div class="nav">
        <div>
          <a href="dashboard.html">Dashboard</a>
          <a href="contacts.html">Contacts</a>
          <a href="volunteer-hours.html">Volunteer Hours</a>
          <a href="dashboard.html#email-flow">Email Mgmt</a>
          <a href="#" id="aboutLink">About</a>
        </div>
        <div>
          <button class="logout" onclick="logout()">Log Out</button>
        </div>
      </div>
    </div>
  </header>

  <main class="shell">
    <div class="grid">
      <!-- LEFT: Quick Actions + Recent Contacts -->
      <section class="card">
        <h2>Quick Actions</h2>
        <div class="actions">
          <div class="action">
            <b>Add Contact</b>
            <p class="muted">Create a new participant, donor, or partner.</p>
            <button class="btn" onclick="openQuickAdd()">Open Form</button>
          </div>
          <div class="action">
            <b>Import CSV</b>
            <p class="muted">Name,Email,Phone,Role,Tags</p>
            <input id="csvInput" type="file" accept=".csv" onchange="importCSV(event)" />
          </div>
          <div class="action">
            <b>Export Contacts</b>
            <p class="muted">Download JSON of all records.</p>
            <button class="btn secondary" onclick="exportContacts()">Export</button>
          </div>
          <div class="action">
            <b>Log Interaction</b>
            <p class="muted">Add a quick note tied to a contact.</p>
            <button class="btn" onclick="logInteraction()">Add Note</button>
          </div>
          <div class="action">
            <b>Schedule Follow-up</b>
            <p class="muted">Create a personal task/reminder.</p>
            <button class="btn" onclick="createTask()">Create Task</button>
          </div>
        </div>

        <!-- Quick Add form -->
        <div id="quickAdd" style="margin-top:14px; display:none">
          <h3 style="margin:.5rem 0">Quick Add Contact</h3>
          <div class="row">
            <div>
              <label for="qName">Full Name</label>
              <input id="qName" placeholder="Jane Doe"/>
            </div>
            <div>
              <label for="qRole">Type</label>
              <select id="qRole">
                <option>Participant</option>
                <option>Donor</option>
                <option>Volunteer</option>
                <option>Partner</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="qEmail">Email</label>
              <input id="qEmail" type="email" placeholder="jane@example.org"/>
            </div>
            <div>
              <label for="qPhone">Phone</label>
              <input id="qPhone" placeholder="(555) 123-4567"/>
            </div>
          </div>
          <label for="qTags">Tags</label>
          <input id="qTags" placeholder="donor, newsletter"/>
          <div style="margin-top:8px">
            <button class="btn" onclick="saveQuickAdd()">Save</button>
            <button class="btn danger" onclick="closeQuickAdd()">Cancel</button>
          </div>
        </div>

        <div style="height:16px"></div>
        <h2>Recent Contacts</h2>
        <div class="row" style="margin-bottom:10px">
          <input id="search" placeholder="Search contacts…" oninput="renderContacts()"/>
          <select id="roleFilter" onchange="renderContacts()">
            <option value="">All types</option>
            <option>Participant</option><option>Donor</option><option>Volunteer</option><option>Partner</option>
          </select>
        </div>
        <div id="tableWrap"></div>
      </section>

      <!-- RIGHT: Tasks -->
      <aside class="card">
        <h2>My Tasks</h2>
        <div class="row">
          <input id="taskText" placeholder="Follow up with Alex about monthly gift"/>
          <button class="btn" onclick="addTask()">Add</button>
        </div>
        <ul id="taskList" style="padding-left:20px;margin-top:10px"></ul>
        <button class="btn danger" onclick="clearTasks()">Clear All</button>
      </aside>
    </div>

    <!-- ===== Email Management (Flow Design) – NO CURRENT FUNCTIONALITY ===== -->
    <section id="email-flow" class="card flow-card" style="display:none">
      <h2>Email Management (Flow Design)</h2>

      <div class="flow">
        <!-- Row 1: TRIGGER AND AUDIENCE -->
        <div class="flow-row">
          <div class="node">
            <h4>Trigger</h4>
            <div class="kv"><b>Type:</b> Event or Schedule</div>
            <div class="kv"><b>Examples:</b> New Donation, Signup, Monthly Newsletter</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Edit</button>
            </div>
          </div>

          <div class="flow-arrows" aria-hidden="true">
            <svg viewBox="0 0 100 30" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- horizontal line -->
              <path d="M5 15 H85" stroke="#063F1E" stroke-width="3"/>
              <!-- arrow head -->
              <path d="M85 7 L95 15 L85 23 Z" fill="#063F1E"/>
            </svg>
          </div>

          <div class="node">
            <h4>Audience</h4>
            <div class="kv"><b>Segment:</b> Donors, Participants, Volunteers, Partners</div>
            <div class="kv"><b>Filter:</b> Tags (e.g., <i>monthly</i>, <i>gala 2025</i>)</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Edit</button>
            </div>
          </div>
        </div>

        <!-- Row 2: TEMPLATE AND PERSONALIZATION -->
        <div class="flow-row">
          <div class="node">
            <h4>Template</h4>
            <div class="kv"><b>Layout:</b> Announcement, Thank-You, Event Invite</div>
            <div class="kv"><b>Branding:</b> Colors, Logo, Footer</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Choose</button>
            </div>
          </div>

          <div class="flow-arrows" aria-hidden="true">
            <svg viewBox="0 0 100 30" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 15 H85" stroke="#063F1E" stroke-width="3"/>
              <path d="M85 7 L95 15 L85 23 Z" fill="#063F1E"/>
            </svg>
          </div>

          <div class="node">
            <h4>Personalization</h4>
            <div class="kv"><b>Merge Fields:</b> {{FirstName}}, {{LastGift}}, {{EventName}}</div>
            <div class="kv"><b>Preview:</b> Sample recipient view</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Preview</button>
            </div>
          </div>
        </div>

        <!-- Row 3: SCHEDULE + COMPLIANCE -->
        <div class="flow-row">
          <div class="node">
            <h4>Schedule</h4>
            <div class="kv"><b>Send:</b> Now or Later</div>
            <div class="kv"><b>Windows:</b> Best-time suggestions</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Set Time</button>
            </div>
          </div>

          <div class="flow-arrows" aria-hidden="true">
            <svg viewBox="0 0 100 30" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 15 H85" stroke="#063F1E" stroke-width="3"/>
              <path d="M85 7 L95 15 L85 23 Z" fill="#063F1E"/>
            </svg>
          </div>

          <div class="node">
            <h4>Compliance</h4>
            <div class="kv"><b>Preferences:</b> Unsubscribe, Opt-in</div>
            <div class="kv"><b>Footer:</b> Organization address & contact</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Review</button>
            </div>
          </div>
        </div>

        <!-- Row 4: REVIEW AND CONFIRM -->
        <div class="flow-row">
          <div class="node" style="flex: 1 1 100%">
            <h4>Review & Confirm</h4>
            <div class="kv"><b>Checklist:</b> Trigger ✓ Audience ✓ Template ✓ Personalization ✓ Schedule ✓ Compliance ✓</div>
            <div class="actions" style="margin-top:8px">
              <button class="btn-ghost-sm" aria-disabled="true">Generate Summary</button>
              <button class="btn-ghost-sm" aria-disabled="true">Save Draft</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== Shared keys with original page =====
    const LS = { session:"tfa_session", contacts:"tfa_contacts_v1", tasks:"tfa_tasks_v1" };

    // ===== Guard: require login =====
    if(!localStorage.getItem(LS.session)){
      alert("Please log in first.");
      window.location.href = "tfa-crm.html";
    }

    // ===== Utilities =====
    const $ = s => document.querySelector(s);
    const esc = s => String(s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
    const uid = () => Math.random().toString(36).slice(2,9);

    function logout(){
      localStorage.removeItem(LS.session);
      window.location.href = "main.html";
    }

    // ===== Contacts store =====
    function readContacts(){ try{return JSON.parse(localStorage.getItem(LS.contacts))||[]}catch{return[]} }
    function writeContacts(a){ localStorage.setItem(LS.contacts, JSON.stringify(a)); renderContacts(); }

    // ===== Tasks store =====
    function readTasks(){ try{return JSON.parse(localStorage.getItem(LS.tasks))||[]}catch{return[]} }
    function writeTasks(a){ localStorage.setItem(LS.tasks, JSON.stringify(a)); renderTasks(); }

    // ===== Quick Add =====
    function openQuickAdd(){ $("#quickAdd").style.display="block"; }
    function closeQuickAdd(){ $("#quickAdd").style.display="none"; }
    function saveQuickAdd(){
      const item = {
        id: uid(),
        name: $("#qName").value.trim(),
        role: $("#qRole").value,
        email: $("#qEmail").value.trim(),
        phone: $("#qPhone").value.trim(),
        tags: $("#qTags").value.split(",").map(s=>s.trim()).filter(Boolean),
        updatedAt: Date.now()
      };
      if(!item.name){ alert("Name is required."); return }
      const list = readContacts(); list.push(item); writeContacts(list);
      closeQuickAdd();
      $("#qName").value = $("#qEmail").value = $("#qPhone").value = $("#qTags").value = "";
    }

    // ===== Import / Export =====
    function exportContacts(){
      const data = JSON.stringify(readContacts(), null, 2);
      const blob = new Blob([data], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "tfa-contacts.json"; a.click();
      URL.revokeObjectURL(url);
    }

    function importCSV(e){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const lines = reader.result.split(/\r?\n/).filter(Boolean);
        const [h, ...rows] = lines;
        const headers = h.split(",").map(s=>s.trim().toLowerCase());
        const out = readContacts();
        rows.forEach(line=>{
          const cols = line.split(",").map(s=>s.trim());
          const obj = {};
          headers.forEach((k,i)=> obj[k] = cols[i] || "");
          out.push({
            id: uid(),
            name: obj.name || "",
            email: obj.email || "",
            phone: obj.phone || "",
            role: obj.role || "Participant",
            tags: (obj.tags||"").split(";").map(s=>s.trim()).filter(Boolean),
            updatedAt: Date.now()
          });
        });
        writeContacts(out);
        alert("Imported " + rows.length + " rows.");
        e.target.value = "";
      };
      reader.readAsText(file);
    }

    // ===== Log Interaction (demo) =====
    function logInteraction(){
      const name = prompt("Log note for which contact name?");
      if(!name) return;
      const note = prompt("Enter interaction/note:");
      if(!note) return;
      const list = readContacts();
      const c = list.find(x => (x.name||"").toLowerCase() === name.toLowerCase());
      if(!c){ alert("Contact not found."); return }
      c.notes = (c.notes ? c.notes + "\n" : "") + new Date().toLocaleString() + ": " + note;
      c.updatedAt = Date.now();
      writeContacts(list);
      alert("Note added.");
    }

    // ===== Tasks =====
    function addTask(){
      const v = $("#taskText").value.trim();
      if(!v) return;
      const list = readTasks(); list.push({ id: uid(), text: v, done:false });
      writeTasks(list); $("#taskText").value="";
    }
    function toggleTask(id){
      const list = readTasks();
      const t = list.find(x=>x.id===id); if(t){ t.done=!t.done; writeTasks(list); }
    }
    function clearTasks(){ if(confirm("Clear all tasks?")) writeTasks([]); }

    function renderTasks(){
      const list = readTasks();
      $("#taskList").innerHTML = list.map(t=>`
        <li>
          <label>
            <input type="checkbox" ${t.done?"checked":""} onchange="toggleTask('${t.id}')">
            ${esc(t.text)}
          </label>
        </li>
      `).join("") || `<p class="empty">No tasks yet.</p>`;
    }

    // ===== Contacts table =====
    function renderContacts(){
      const q = ($("#search").value||"").toLowerCase();
      const role = $("#roleFilter").value;
      const data = readContacts()
        .filter(c=>{
          const blob = `${c.name} ${c.email} ${c.phone} ${c.role} ${(c.tags||[]).join(" ")}`.toLowerCase();
          const passQ = blob.includes(q);
          const passR = !role || (c.role === role);
          return passQ && passR;
        })
        .sort((a,b)=> (b.updatedAt||0) - (a.updatedAt||0))
        .slice(0,10);

      if(data.length===0){
        $("#tableWrap").innerHTML = `<div class="empty">No contacts yet. Try “Add Contact”.</div>`;
        return;
      }

      $("#tableWrap").innerHTML = `
        <table>
          <thead><tr>
            <th>Name</th><th>Type</th><th>Email</th><th>Phone</th><th>Tags</th>
          </tr></thead>
          <tbody>
            ${data.map(r=>`
              <tr>
                <td>${esc(r.name||"")}</td>
                <td><span class="tag">${esc(r.role||"")}</span></td>
                <td>${esc(r.email||"")}</td>
                <td>${esc(r.phone||"")}</td>
                <td>${(r.tags||[]).map(t=>`<span class="tag" style="margin-right:6px">${esc(t)}</span>`).join("")}</td>
              </tr>`).join("")}
          </tbody>
        </table>
        <p class="muted" style="margin:.25rem 0 0">Showing latest 10 by recent activity.</p>
      `;
    }

    // ===== Simple hash-based toggler to show the Email Flow when link clicked =====
    function showByHash() {
      const target = location.hash || "#";
      const emailCard = document.getElementById("email-flow");
      if (!emailCard) return;
      if (target === "#email-flow") {
        emailCard.style.display = "block";
        emailCard.scrollIntoView({ behavior: "smooth", block: "start" });
      } else {
        emailCard.style.display = "none";
      }
    }
    window.addEventListener("hashchange", showByHash);
    window.addEventListener("DOMContentLoaded", showByHash);

    // Seed if empty so the dashboard isn’t blank
    (function init(){
      if(readContacts().length===0){
        writeContacts([{ id: uid(), name:"Alex Rivera", role:"Donor", email:"alex@donors.org", phone:"555-0102", tags:["monthly","newsletter"], updatedAt: Date.now() }]);
      } else {
        renderContacts();
      }
      renderTasks();
    })();

    // About link (simple modal/alert for demo)
    document.getElementById("aboutLink").addEventListener("click", e=>{
      e.preventDefault();
      alert("The Family Advocates CRM Demo\nBrand: Deep Green #063F1E, Heritage Gold #D89F01\nThis dashboard is a static mock—wire to your backend for production.");
    });
  </script>
</body>
</html>
